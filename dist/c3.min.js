var c3=function(){function b(a,b){return a===b}function c(c){return b(c,a)}function d(a,b){if(a!==b.type)throw"invalid type: expected '"+a+"', "+"received '"+b.type+"'"}function e(a){return parseInt(a,10)}function f(a){return d("piece",a),c3.square(a.size,a.playerId)}function g(a){return JSON.stringify(a)}function h(a){return JSON.parse(a)}function i(){c3.game.addResetNotification(c3.board.reset),c3.game.addResetNotification(c3.ui.run),c3.game.reset()}"use strict";var a=-1;return{none:a,player1:0,player2:1,smallPiece:0,largePiece:1,isNone:c,equals:b,ensureType:d,toInt:e,toSquare:f,serialize:g,deserialize:h,init:i}}();c3.player=function(a){function c(c){return c3.ensureType(b,c),c3.equals(a,c.id)}"use strict";var b="player";return{type:b,id:a,equals:c}},c3.piece=function(a,b){function f(){return c3.isNone(a)?"":"piece-"+a+" player-"+b}function g(d){return c3.ensureType(c,d),c3.equals(a,d.size)&&c3.equals(b,d.playerId)}function h(){return a===c3.none?c3.smallPiece:c3.largePiece}"use strict";var c="piece",d,e;return e=f(),{type:c,className:e,size:a,playerId:b,equals:g,getNextSize:h}},c3.square=function(a,b){return"use strict",{type:"square",playerId:b,size:a}},c3.game=function(a){function i(){c=a.serialize({type:b,playerId:d,squares:e,over:g,winningPlayerId:h})}function j(a){f.push(a)}function k(a){d=a,i()}function l(a,b){e[a]=b,i()}function m(b){h=b,g=b!==a.none,i()}function n(){return a.deserialize(c)}function o(j){var k=f.length-1;a.ensureType(b,j);if(a.equals(c,a.serialize(j)))return;d=j.playerId,e=j.squares,g=j.over,h=j.winningPlayerId,i();if(k>0)while(k>=0)f[k].call(null,j),k-=1}function p(){var c=c3.square(a.none,a.none),d;for(d=0;d<9;d+=1)e[d]=c;o({type:b,playerId:a.player1,squares:e,over:g,winningPlayerId:h})}"use strict";var b="game",c=null,d=a.player1,e=[],f=[],g=!1,h=a.none;return{get:n,set:o,reset:p,saveCurrentPlayerId:k,saveSquare:l,addResetNotification:j,saveWinningPlayerId:m}}(c3),c3.board=function(a){function d(b){var d=c.length-1,e=b.squares,f,g;while(d>=0){g=!1;while(!g){f=e[c[d][0]].playerId;if(a.isNone(f))g=!0;else{if(a.equals(f,e[c[d][1]].playerId)&&a.equals(f,e[c[d][2]].playerId))return f;g=!0}}d-=1}return a.none}function e(a){return b[a]}function f(c,e,f){b[c]=e,f.saveSquare(c,a.toSquare(e)),f.saveCurrentPlayerId(a.equals(e.playerId,a.player1)?a.player2:a.player1),f.saveWinningPlayerId(d(f.get()))}function g(b){return a.ensureType("square",b),a.piece(b.size,b.playerId)}function h(a){var c=a.squares,d;for(d=0;d<9;d+=1)b[d]=g(c[d])}"use strict";var b=[],c=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];return{getSquarePiece:e,setSquarePiece:f,reset:h}}(c3),c3.ui=function(a,b,c,d){function g(a,e,f){c.setSquarePiece(a,b.piece(e,f),d)}function h(b,c,d){a("#"+b).html('<img src="images/piece'+d.size+"_player"+d.playerId+'.svg" />').removeClass(c.className).addClass(d.className)}function i(b){var c=a("#"+b);c.hasClass("sqr")&&a("#"+b).off("click").removeClass("sqr").addClass("sqr-off")}function j(){a("*").css("cursor","default"),a(".sqr").off("click").removeClass("sqr").addClass("sqr-off")}function k(b){a("#message").text(b)}function l(c){var d="player-"+(b.equals(c,b.player1)?b.player2:b.player1);a("#message").removeClass(d).addClass("player-"+c),k("Player "+(c+1)+"'s turn.")}function m(a){var e,f,m;e=c.getSquarePiece(a);if(e.size===b.smallPiece&&e.playerId===d.get().playerId)return;f=b.piece(e.getNextSize(),d.get().playerId),g(a,f.size,f.playerId),h(a,e,f),f.size===b.largePiece&&i(a),m=d.get(),m.over?(j(),k("PLAYER "+(m.winningPlayerId+1)+" WINS!")):l(m.playerId)}function n(){f.on("click",function(a){m(b.toInt(a.target.id)),e.css("cursor","pointer")}),f.mousedown(function(a){a.originalEvent.preventDefault?a.originalEvent.preventDefault():event.returnValue=!1}),l(0),e.fadeIn("slow")}"use strict";var e=a("#gridContainer"),f=a(".sqr");return{run:n,setMessage:k}}(jQuery,c3,c3.board,c3.game);